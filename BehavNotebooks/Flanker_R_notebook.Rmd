---
title: "Flanker Notebook"
output:
  html_document:
    toc: yes
    toc_float: yes
  html_notebook: default
  pdf_document: default
---

# **Flanker PRE DATA ANALYSIS**
N=56 (Control+Experimental)
There is a 3rd undefined Condition for those that have completed this task, but have dropped out for one reason or another.
note: sub190 and sub197 have no pre data (all responses were innacurate with no reaction times)

## **Data Prep**
Getting the Data ready for analysis
Defaults: R uses dummy coding as it's default. In this sample, the control Condition and the congruent condition will be the dummy variables in the analysis. So all Estimates are relative to these dummy variables

### Load Requisite R Packages
note: some of these may not actually be used.
Step 1) load the necessary libraries

```{r}
library(ggplot2)
library(lme4)
library(languageR) 
library(lmerTest) #give p-values from mixed models
library(influence.ME)
library(plyr) # magic
library(scales) #for making percents on the y-axis of graphs
```

### Read in the dataset (in current directory)
```{r}
Flanker_data = read.table("Flanker_R_format.csv", header = TRUE, sep = ",")
```

### Omit missing data (e.g. from practice trials)
```{r}
Flanker_data = na.omit(Flanker_data)  
head(Flanker_data, n = 20) 
```


### Omit the Undefined Condition from the data and specify Condition as a factor
```{r}
Flanker_data <- subset(Flanker_data,Condition=="Control" | Condition=="Experimental")
Flanker_data$Condition <- factor(Flanker_data$Condition)
summary(Flanker_data)
contrasts(Flanker_data$Condition)
```


### Omit the Practice stimtype and specify stimtype as a factor
```{r}
Flanker_data <- subset(Flanker_data,stimtype=="con" | stimtype=="inc" | stimtype=="neu")
Flanker_data$stimtype <- factor(Flanker_data$stimtype)
summary(Flanker_data)
contrasts(Flanker_data$stimtype)
```

### Isolate the session to the first session
```{r}
Flanker_data_pre <- subset(Flanker_data, session=="Pre") 
Flanker_data_pre$session <- factor(Flanker_data_pre$session)
summary(Flanker_data_pre)
```


### specify subject as a factor
```{r}
Flanker_data_pre$subject <- as.factor(Flanker_data_pre$subject)

summary(Flanker_data_pre)
```

## Flanker Accuracy Analysis

### Graph Accuracy Data
```{r, message=FALSE, warning=FALSE}
#Control Condition Data
Flanker_data_pre_control <- subset(Flanker_data_pre, Condition=="Control")
#change binary data to a percent
Flanker_data_pre_control_percent <- ddply(Flanker_data_pre_control, .(stimtype, subject), summarize, ACC_perc = mean(ACC))

#Experimental Condition Data
Flanker_data_pre_experimental <- subset(Flanker_data_pre, Condition=="Experimental")
#change binary data to a percent
Flanker_data_pre_experimental_percent <- ddply(Flanker_data_pre_experimental, .(stimtype, subject), summarize, ACC_perc = mean(ACC))

ggplot(data = Flanker_data_pre_control_percent, aes( x = stimtype, y = ACC_perc)) + geom_bar(stat = "identity", width = 0.5) + facet_wrap(~subject) + scale_y_continuous(labels=percent) + scale_x_discrete(labels=c("Con","Inc","Neu")) + ggtitle("Control")

ggplot(data = Flanker_data_pre_experimental_percent, aes( x = stimtype, y = ACC_perc)) + geom_bar(stat = "identity", width = 0.5) + facet_wrap(~subject) + scale_y_continuous(labels=percent) +  scale_x_discrete(labels=c("Con","Inc","Neu")) + ggtitle("Experimental")
```

**Conclusion**: 
Problem Subjects: 
sub190
sub197
sub39

Less Problematic subjects
sub86
sub7
sub74
sub98
sub191

### Excluding subjects without/minimal data
```{r}
Flanker_data_pre <- subset(Flanker_data_pre, subject != 190 & subject != 197 & subject != 39)
summary(Flanker_data_pre)
```


### Model Accuracy (Logit)
```{r}
Flanker_ACC_model<-glmer(ACC ~ Condition*stimtype + (1|subject), family=binomial, data=Flanker_data_pre, verbose=TRUE)
summary(Flanker_ACC_model)
```

**Conclusion**: no Condition differences (as expected). Participant's were significantly less accurate in the Incongruent condition (as expected) and the neutral condition (less expected)

## Flanker Reaction Time Analysis

### Format RT data 
(subset for RTs when they are accurate, greater than 200ms, and less than 2000 ms)
See how many observations are lost when we subset the data
```{r}
#all observations
print("All Data")
All_data <- length(Flanker_data_pre$RT)
summary(Flanker_data_pre)

#remove innacurate responses
print("Removed innacurate trials (from all data dataframe)")
Flanker_data_pre_RT <- subset(Flanker_data_pre, ACC==1)
All_acc_data <- length(Flanker_data_pre_RT$RT)
summary(Flanker_data_pre_RT)

#remove short and long RTs
print("Removed slow and fast RTs")
Flanker_data_pre_RT <- subset(Flanker_data_pre_RT, RT>200 & RT<2000)
filtered_data <- length(Flanker_data_pre_RT$RT)
summary(Flanker_data_pre_RT)

print("Percentage of Data Removed")
perc_data_rm <- (1 - (filtered_data/All_acc_data) ) * 100
perc_data_rm
```

**Conclusion**: No Data removed from filtering. Good to go.


### Graph RT data
Note: just doing it by stimtype since subject data appears to be in good ranges
```{r, message=FALSE, warning=FALSE}
#hist(subset(Flanker_data_pre_RT, Condition=="Control")$RT,ylim=c(0,1600))
#hist(subset(Flanker_data_pre_RT, Condition=="Experimental")$RT,ylim=c(0,1600))
ggplot(data = subset(Flanker_data_pre_RT, Condition=="Control"), aes(subset(Flanker_data_pre_RT, Condition=="Control")$RT)) + geom_histogram() + facet_wrap(~subset(Flanker_data_pre_RT, Condition=="Control")$stimtype) + scale_y_continuous(limits = c(0,550)) + scale_x_continuous(limits = c(0,2000))

ggplot(data = subset(Flanker_data_pre_RT, Condition=="Experimental"), aes(subset(Flanker_data_pre_RT, Condition=="Experimental")$RT)) + geom_histogram() + facet_wrap(~subset(Flanker_data_pre_RT, Condition=="Experimental")$stimtype) + scale_y_continuous(limits = c(0,550)) + scale_x_continuous(limits = c(0,2000))

```

**Conclusion**: data show a bit of skew, will transform to see if they look better

### Log Transform RT data
```{r}
Flanker_data_pre_RT$log_RT <- log(1/Flanker_data_pre_RT$RT)
```

### graph logged RT data
```{r, message=FALSE, warning=FALSE}
#hist(subset(Flanker_data_pre_RT, Condition=="Control")$RT,ylim=c(0,1600))
#hist(subset(Flanker_data_pre_RT, Condition=="Experimental")$RT,ylim=c(0,1600))
ggplot(data = subset(Flanker_data_pre_RT, Condition=="Control"), aes(subset(Flanker_data_pre_RT, Condition=="Control")$log_RT)) + geom_histogram() + facet_wrap(~subset(Flanker_data_pre_RT, Condition=="Control")$stimtype) + scale_y_continuous(limits = c(0,550))

ggplot(data = subset(Flanker_data_pre_RT, Condition=="Experimental"), aes(subset(Flanker_data_pre_RT, Condition=="Experimental")$log_RT)) + geom_histogram() + facet_wrap(~subset(Flanker_data_pre_RT, Condition=="Experimental")$stimtype) + scale_y_continuous(limits = c(0,550))

```

**Conclusion**: The transformed data look slightly better, I will run the model on both


### Model RT by Condition and stimtype
```{r}
Flanker_RT_model <- lmer(RT ~ Condition*stimtype + (1|subject), data = Flanker_data_pre_RT)
summary(Flanker_RT_model)
```

**Conclusions**: No main Condition effect or interactions (as expected), The incongruent condition is slower relative to the congruent condition (as expected). However, the neutral condition is faster than the congruent condition, which is unexpected.

### Model log RT by Condition and stimtype
```{r}
Flanker_log_RT_model <- lmer(log_RT ~ Condition*stimtype + (1|subject), data = Flanker_data_pre_RT)
summary(Flanker_log_RT_model)
```

**Conclusion**: Same story as the untransformed data.

## Conclusions
good: 
No overall Condition differences in RT and Accuracy

bad:
190,197, and 39 have almost no data.
several other subjects have low accuracies.
The neutral reaction times are faster than the congruent reaction times (unexpected)