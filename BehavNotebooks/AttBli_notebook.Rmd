---
title: "AttBli Notebook"
output:
  html_document:
    toc: yes
    toc_float: yes
  html_notebook: default
---

TODO: check on EOL warnings from csv file

# Attentional Blink PRE DATA ANALYSIS

ATTENTION BLINK BACKGROUND: http://www.scholarpedia.org/article/Attentional_blink
N=55 (Control+Experimental)
^Missing data from sub7
There is a 3rd undefined group for those that have completed this task, but have dropped out for one reason or another.

## Data Prep
Getting the Data ready for analysis
Defaults: R uses dummy coding as it's default. In this sample, the control group and the 1-Back will be the dummy variables in the analysis. So all Estimates are relative to these dummy variables

### Load Requisite R Packages
note: some of these may not actually be used.
```{r Loading R Packages}
library(ggplot2)
library(lme4)
library(languageR) 
library(lmerTest)
library(influence.ME)
```


### Read in the dataset (in current directory)
```{r}
AttBli_data = read.table("AttBli_R_format.csv", 
header = TRUE, sep = ",")
```

### Omit missing data (e.g. from practice trials)
```{r}
AttBli_data= na.omit(AttBli_data)  
head(AttBli_data, n = 20) 
```

### Omit the Undefined group from the data and specify group as a factor
```{r}
AttBli_data <- subset(AttBli_data,group=="Control" | group=="Experimental")
AttBli_data$group <- factor(AttBli_data$group)
summary(AttBli_data)
contrasts(AttBli_data$group)
```

### Isolate the session to the first session
```{r}
AttBli_data_pre <- subset(AttBli_data, session==1) 
AttBli_data_pre$session <- factor(AttBli_data_pre$session)
summary(AttBli_data_pre)
```

### Specify subject as a factor
```{r}
AttBli_data_pre$subject <- as.factor(AttBli_data_pre$subject)

summary(AttBli_data_pre)
```

### Specify stimtype (probe in relation to cue) as a factor
Note: could treat this as a continuous variable instead of a discrete factor, up for debate.
stimtype(-1,2,4,6,8)
```{r}
AttBli_data_pre$stimtype <- as.factor(AttBli_data_pre$stimtype)
summary(AttBli_data_pre)
```

## AttBli Accuracy Analysis

### Print out accuracy data for each subject for each group
Note: This is without filtering for whether the participant got the letter cue right or not.
```{r, message=FALSE, warning=FALSE}
#subset data by experimental and control groups
AttBli_data_pre_control <- subset(AttBli_data_pre, group=="Control")
AttBli_data_pre_experimental <- subset(AttBli_data_pre, group=="Experimental")

#print control group data
g1 <- ggplot(data = AttBli_data_pre_control, aes(x = as.numeric(AttBli_data_pre_control$stimtype), y = AttBli_data_pre_control$probe_ACC))
g2 <- g1 + geom_point(alpha=.5) + geom_smooth(method='loess')
g3 <- g2 + scale_x_discrete(name = "distance from cue", limits=c("-1","2","4","6","8"))
g4 <- g3 + scale_y_discrete(name = "Probability of guessing existance of probe", limits=c(0,1))
g5 <- g4 + coord_cartesian(ylim =c(-.1,1.1), expand = FALSE) + facet_wrap(~subject) + ggtitle("Control Probe ACC")
print(g5)

#print experimental group data
g1 <- ggplot(data = AttBli_data_pre_experimental, aes(x = as.numeric(AttBli_data_pre_experimental$stimtype), y = AttBli_data_pre_experimental$probe_ACC))
g2 <- g1 + geom_point(alpha=.5) + geom_smooth(method='loess')
g3 <- g2 + scale_x_discrete(name = "distance from cue", limits=c("-1","2","4","6","8"))
g4 <- g3 + scale_y_discrete(name = "Probability of guessing existance of probe", limits=c(0,1))
g5 <- g4 + coord_cartesian(ylim =c(-.1,1.1), expand = FALSE) + facet_wrap(~subject) + ggtitle("Experimental Probe ACC")
print(g5)

```

**Conclusion**: While a majority of the subjects show the expected pattern, many do not fit the pattern, or do not fit the pattern well. The next section will graph the results restricting them to only trials where the participant got the cue letter correct.

### Print out accuracy data for each subject for each group (filtering for letter cue accuracy)
Graphs where we only look at probe accuracy when the participant got the cue correct (matches the concept of attentional blink better)
```{r, message=FALSE, warning=FALSE}
AttBli_data_pre_cue_filter <- subset(AttBli_data_pre, letter_ACC=="1")
#subset data by experimental and control groups
AttBli_data_pre_cue_filter_control <- subset(AttBli_data_pre_cue_filter, group=="Control")
AttBli_data_pre_cue_filter_experimental <- subset(AttBli_data_pre_cue_filter, group=="Experimental")

#print control group data
g1 <- ggplot(data = AttBli_data_pre_cue_filter_control, aes(x = as.numeric(stimtype), y = probe_ACC))
g2 <- g1 + geom_point(alpha=.5) + geom_smooth(method='loess')
g3 <- g2 + scale_x_discrete(name = "distance from cue", limits=c("-1","2","4","6","8"))
g4 <- g3 + scale_y_discrete(name = "Probability of guessing existance of probe", limits=c(0,1))
g5 <- g4 + coord_cartesian(ylim =c(-.1,1.1), expand = FALSE) + facet_wrap(~subject) + ggtitle("Control Probe ACC")
print(g5)

#print experimental group data
g1 <- ggplot(data = AttBli_data_pre_cue_filter_experimental, aes(x = as.numeric(stimtype), y = probe_ACC))
g2 <- g1 + geom_point(alpha=.5) + geom_smooth(method='loess')
g3 <- g2 + scale_x_discrete(name = "distance from cue", limits=c("-1","2","4","6","8"))
g4 <- g3 + scale_y_discrete(name = "Probability of guessing existance of probe", limits=c(0,1))
g5 <- g4 + coord_cartesian(ylim =c(-.1,1.1), expand = FALSE) + facet_wrap(~subject) + ggtitle("Experimental Probe ACC")
print(g5)

```

**Conclusion**: Honestly, the graphs don't look much different, so is this ouput normal?

### model probe Accuracy using logistic regression
Using the letter cue filtered data because it's closer to what we want to test psychologically.
```{r}
probe_ACC_model<-glmer(probe_ACC ~ group*stimtype + (1|subject), family=binomial, data=AttBli_data_pre_cue_filter, verbose=TRUE)
summary(probe_ACC_model)
```

**Conclusion**: there is no overall group effect (as expected), but there are some interactions between group and how large the distance between cue and probe was. These may warrant further investigation.



### Print letter cue accuracy data
There were four choices so random guessing should give about 25% correct
```{r, message=FALSE, warning=FALSE}
AttBli_data_pre_control <- subset(AttBli_data_pre, group=="Control")
AttBli_data_pre_experimental <- subset(AttBli_data_pre, group=="Experimental")

g1 <- ggplot(data = AttBli_data_pre_control, aes(x = as.numeric(AttBli_data_pre_control$stimtype), y = AttBli_data_pre_control$letter_ACC))
g2 <- g1 + geom_point(alpha=.5) + geom_smooth(method='loess')
g3 <- g2 + scale_x_discrete(name = "distance from cue", limits=c("-1","2","4","6","8"))
g4 <- g3 + scale_y_discrete(name = "Probability of guessing cue correctly", limits=c(0,1))
g5 <- g4 + coord_cartesian(ylim =c(-.1,1.1), expand = FALSE) + facet_wrap(~subject) + ggtitle("Control Cue Letter ACC")
print(g5)

g1 <- ggplot(data = AttBli_data_pre_experimental, aes(x = as.numeric(AttBli_data_pre_experimental$stimtype), y = AttBli_data_pre_experimental$letter_ACC))
g2 <- g1 + geom_point(alpha=.5) + geom_smooth(method='loess')
g3 <- g2 + scale_x_discrete(name = "distance from cue", limits=c("-1","2","4","6","8"))
g4 <- g3 + scale_y_discrete(name = "Probability of guessing cue correctly", limits=c(0,1))
g5 <- g4 + coord_cartesian(ylim =c(-.1,1.1), expand = FALSE) + facet_wrap(~subject) + ggtitle("Experimental Cue Letter ACC")
print(g5)
```

**Conclusion**: Participants were generally accurate reporting the identity of the letter cue.

### Model letter accuracy with logistic regression
```{r}
letter_ACC_model<-glmer(AttBli_data_pre$letter_ACC ~ group*stimtype + (1|subject), family=binomial, data=AttBli_data_pre, verbose=TRUE)
summary(letter_ACC_model)
```

**Conclusion**: Both groups had similar accuracy identifying the white letter cue across cue-probe distances (as expected)

## AttBli Reaction Time Analysis

### Format RT data
(subset for RTs when they are accurate, greater than 200ms, and less than 3000 ms)
^The above thresholds were set somewhat arbitrarily, you can play with the thresholds.
See how many observations are lost when we subset the data
```{r}
#all observations
print("All Data")
All_data_probe <- length(AttBli_data_pre$probe_RT)
summary(AttBli_data_pre)

#remove innacurate responses
print("Removed innacurate probe trials (from all data dataframe)")
AttBli_data_pre_probe_RT <- subset(AttBli_data_pre, probe_ACC==1)
All_Accurate_data_probe <- length(AttBli_data_pre_probe_RT$probe_RT)
summary(AttBli_data_pre_probe_RT)
#remove short and long RTs
print("Removed slow and fast RTs")
AttBli_data_pre_probe_RT <- subset(AttBli_data_pre_probe_RT, probe_RT>200 & probe_RT<3000)
filtered_data_probe <- length(AttBli_data_pre_probe_RT$probe_RT)
summary(AttBli_data_pre_probe_RT)

print("Percentage Probe Data Removed")
percent_data_rm_probe <- (1 - (filtered_data_probe/All_Accurate_data_probe)) * 100
percent_data_rm_probe

#remove innacurate responses
print("Removed innacurate letter trials (from all data dataframe")
AttBli_data_pre_letter_RT <- subset(AttBli_data_pre, letter_ACC==1)
All_Accurate_data_cue <- length(AttBli_data_pre_letter_RT$letter_RT)
summary(AttBli_data_pre_letter_RT)

#remove short and long RTs
print("Removed slow and fast RTs")
AttBli_data_pre_letter_RT <- subset(AttBli_data_pre_probe_RT, letter_RT>200 & letter_RT<3000)
filtered_data_cue <- length(AttBli_data_pre_letter_RT$letter_RT)
summary(AttBli_data_pre_letter_RT)

print("Percentage Cue Data Removed")
percent_data_rm_cue <- (1 - (filtered_data_cue/All_Accurate_data_cue)) * 100
percent_data_rm_cue

```

**Conclusion**: take a deeper look at the letter RTs to see what's going on, way too many data cut off (about 24%)

### Graph probe RT data
```{r, message=FALSE, warning=FALSE}
AttBli_data_pre_probe_RT_control <- subset(AttBli_data_pre_probe_RT, group=="Control")

AttBli_data_pre_probe_RT_experimental <- subset(AttBli_data_pre_probe_RT, group=="Experimental")


RT_hist_control <- ggplot(data = AttBli_data_pre_probe_RT_control, aes(probe_RT)) + geom_histogram(binwidth = 30) + facet_wrap(~subject) + scale_y_continuous(limits = c(0,25)) + scale_x_continuous(limits = c(0,2000))
print(RT_hist_control)

RT_hist_experimental <- ggplot(data = AttBli_data_pre_probe_RT_experimental, aes(probe_RT)) + geom_histogram(binwidth = 30) + facet_wrap(~subject) + scale_y_continuous(limits = c(0,25)) + scale_x_continuous(limits = c(0,2000))
print(RT_hist_experimental)
```

**Conclusion**: Most participants show a right skew, going to log transform the data to see if they look better.

### Log transform RT data
```{r}
AttBli_data_pre_probe_RT$log_probe_RT <- log(1/AttBli_data_pre_probe_RT$probe_RT)
AttBli_data_pre_letter_RT$log_letter_RT <- log(1/AttBli_data_pre_letter_RT$letter_RT)
```



### Graph Log_probe_RT data
```{r, message=FALSE, warning=FALSE}
AttBli_data_pre_probe_RT_control <- subset(AttBli_data_pre_probe_RT, group=="Control")

AttBli_data_pre_probe_RT_experimental <- subset(AttBli_data_pre_probe_RT, group=="Experimental")

#collapsing across stimtype (-1,2,4,6,8), not enough data to make a good histogram, and the graphs become too crowded if I include stimtype as a facet
RT_hist_control <- ggplot(data = AttBli_data_pre_probe_RT_control, aes(log_probe_RT)) + geom_histogram(binwidth = .1) + facet_wrap(~subject) + scale_y_continuous(limits = c(0,50)) + scale_x_continuous(limits = c(-8,-5))
print(RT_hist_control)

RT_hist_experimental <- ggplot(data = AttBli_data_pre_probe_RT_experimental, aes(log_probe_RT)) + geom_histogram(binwidth = .1) + facet_wrap(~subject) + scale_y_continuous(limits = c(0,50)) + scale_x_continuous(limits = c(-8,-5))
print(RT_hist_experimental)
```

**Conclusion**: Probe Data overall looks more normally distributed.

### Model log Probe RT
```{r}
probe_RT_model <- lmer(log_probe_RT ~ group*stimtype + (1|subject), data = AttBli_data_pre_probe_RT)
summary(probe_RT_model)
```

**Conclusion**: No overall Group effect (as expected), but there is an interaction between group and the largest distance between cue and probe. I don't know if this is worth investigating or to chalk it up to having so many comparisons.


### Model logged letter RT by group and lag
```{r}
letter_RT_model <- lmer(log_letter_RT ~ group*stimtype + (1|subject), data = AttBli_data_pre_letter_RT)
summary(letter_RT_model)
```

**Conclusion**: No group effect (as expected), but there is another trending RT difference at the largest cue-probe difference. Not going to read too much into this until I figure out why 23% of the letter cue RT data was so long!


## Conclusions

Good:
No overall Group differences in Reaction Time or Accuracy

Bad:
Accuracy data may not follow the expected pattern in the task
Significant Group*lag interactions in Accuracy and Reaction Time 
Letter cue RT's are abnormally long.

