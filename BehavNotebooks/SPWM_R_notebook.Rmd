---
title: "SPWM Notebook"
output:
  html_document:
    toc: yes
    toc_float: yes
  html_notebook: default
  pdf_document: default
---

TODO: check sub78's raw data to explain low accuracy data

# SPWM PRE DATA ANALYSIS
N=56 (Control+Experimental)
There is a 3rd undefined group for those that have completed this task, but have dropped out for one reason or another.

## Data Prep
Getting the Data ready for analysis
Defaults: R uses dummy coding as it's default. In this sample, the control group and the four_m will be the dummy variables in the analysis. So all Estimates are relative to these dummy variables

### Load Requisite R Packages
note: some of these may not actually be used.
```{r}
library(ggplot2)
library(lme4)
library(languageR) 
library(lmerTest) #give p-values from mixed models
library(influence.ME)
library(plyr) # magic
library(scales) #for making percents on the y-axis of graphs
```


### Read in the dataset (in current directory)
```{r}
SPWM_data = read.table("SPWM_R_format.csv", header = TRUE, sep = ",")
```

### omit missing data (e.g. from practice trials)
```{r}
SPWM_data = na.omit(SPWM_data)  
head(SPWM_data, n = 20) 
```

### Omit the Undefined group from the data and specify group as a factor
```{r}
SPWM_data <- subset(SPWM_data,group=="Control" | group=="Experimental")
SPWM_data$group <- factor(SPWM_data$group)
summary(SPWM_data)
contrasts(SPWM_data$group)
```

### Omit the Undefined stimtype and specify stimtype as a factor
```{r}
SPWM_data <- subset(SPWM_data,stimtype=="four_m" | stimtype=="four_nm")
SPWM_data$stimtype <- factor(SPWM_data$stimtype)
summary(SPWM_data)
contrasts(SPWM_data$stimtype)
```

### Isolate the session to the first session
```{r}
SPWM_data_pre <- subset(SPWM_data, session==1) 
SPWM_data_pre$session <- factor(SPWM_data_pre$session)
summary(SPWM_data_pre)
```

### Specify subject as a factor
```{r}
SPWM_data_pre$subject <- as.factor(SPWM_data_pre$subject)

summary(SPWM_data_pre)
```

## SPWN Accuracy Analysis

### Print Accuracy data for each subject for each group
```{r}
#Control Group Data
SPWM_data_pre_control <- subset(SPWM_data_pre, group=="Control")
#change binary data to a percent
SPWM_data_pre_control_percent <- ddply(SPWM_data_pre_control, .(stimtype, subject), summarize, ACC_perc = mean(ACC))

#Experimental Group Data
SPWM_data_pre_experimental <- subset(SPWM_data_pre, group=="Experimental")
#change binary data to a percent
SPWM_data_pre_experimental_percent <- ddply(SPWM_data_pre_experimental, .(stimtype, subject), summarize, ACC_perc = mean(ACC))

ggplot(data = SPWM_data_pre_control_percent, aes( x = stimtype, y = ACC_perc)) + geom_bar(stat = "identity", width = 0.5) + facet_wrap(~subject) + scale_y_continuous(labels=percent) + scale_x_discrete(labels=c("four_m","four_nm")) + ggtitle("Control")

ggplot(data = SPWM_data_pre_experimental_percent, aes( x = stimtype, y = ACC_perc)) + geom_bar(stat = "identity", width = 0.5) + facet_wrap(~subject) + scale_y_continuous(labels=percent) +  scale_x_discrete(labels=c("four_m","four_nm")) + ggtitle("Experimental")
```

**Conclusion**: sub78,sub164, and sub190 have worrying low accuracy for the non-matching conditions. In fact sub78 did not get any right, should check the raw data to see if they were pressing the wrong key. Otherwise data appear fine.

### Model Accuracy (Logit)
```{r}
SPWM_ACC_model<-glmer(ACC ~ group*stimtype + (1|subject), family=binomial, data=SPWM_data_pre, verbose=TRUE)
summary(SPWM_ACC_model)
```

**Conclusion**: No main effect of group (as expected), but there is an interaction, suggesting some outliers may be influencing the four_nm accuracy measure (looking at you guys: sub78,sub164,sub190).

## Reaction Time Analysis

### Format RT data 
(subset for RTs when they are accurate, greater than 200ms, and less than 5000 ms) (speed wasn't as important in this task)
See how many observations are lost when we subset the data
```{r}
#all observations
print("All Data")
All_data <- length(SPWM_data_pre$RT)
summary(SPWM_data_pre)

#remove innacurate responses
print("Removed innacurate trials (from all data dataframe)")
SPWM_data_pre_RT <- subset(SPWM_data_pre, ACC==1)
All_Acc_Data <- length(SPWM_data_pre_RT$RT)
summary(SPWM_data_pre_RT)

#remove short and long RTs
print("Removed slow and fast RTs")
SPWM_data_pre_RT <- subset(SPWM_data_pre_RT, RT>200 & RT<5000)
filtered_data <- length(SPWM_data_pre_RT$RT)
summary(SPWM_data_pre_RT)

print("Percentage of Data Removed")
perc_data_rm <- (1 - (filtered_data/All_Acc_Data)) * 100
perc_data_rm
```

**Conclusion**: Almost no data is filtered out because of the RTs, looks like one fast response was removed.

### Graph RT data
```{r, message=FALSE, warning=FALSE}
#hist(subset(SPWM_data_pre_RT, group=="Control")$RT,ylim=c(0,300))
#hist(subset(SPWM_data_pre_RT, group=="Experimental")$RT,ylim=c(0,300))

SPWM_data_pre_RT_control <- subset(SPWM_data_pre_RT, group=="Control")

SPWM_data_pre_RT_experimental <- subset(SPWM_data_pre_RT, group=="Experimental")

#collapsing across stimtype (four_m, four_nm), not enough data to make a good histogram, and the graphs become too crowded if I include stimtype as a facet
RT_hist_control <- ggplot(data = SPWM_data_pre_RT_control, aes(RT)) + geom_histogram(binwidth = 30) + facet_wrap(~subject) + scale_y_continuous(limits = c(0,15)) + scale_x_continuous(limits = c(0,2000))
print(RT_hist_control)

RT_hist_experimental <- ggplot(data = SPWM_data_pre_RT_experimental, aes(RT)) + geom_histogram(binwidth = 30) + facet_wrap(~subject) + scale_y_continuous(limits = c(0,15)) + scale_x_continuous(limits = c(0,2000))
print(RT_hist_experimental)
```

**Conclusion**: this RT data does not need to be transformed, looks roughly normal, but I will transform it anyway to see how it looks


### Log Transform RT data
```{r}
SPWM_data_pre_RT$log_RT <- log(1/SPWM_data_pre_RT$RT)
```


Step 13) Graph RT data that should look more normally distributed
```{r, message=FALSE, warning=FALSE}
SPWM_data_pre_RT_control <- subset(SPWM_data_pre_RT, group=="Control")

SPWM_data_pre_RT_experimental <- subset(SPWM_data_pre_RT, group=="Experimental")

#collapsing across stimtype (four_m, four_nm), not enough data to make a good histogram, and the graphs become too crowded if I include stimtype as a facet
RT_hist_control <- ggplot(data = SPWM_data_pre_RT_control, aes(log_RT)) + geom_histogram(binwidth = .1) + facet_wrap(~subject) + scale_y_continuous(limits = c(0,30)) + scale_x_continuous(limits = c(-8,-5))
print(RT_hist_control)

RT_hist_experimental <- ggplot(data = SPWM_data_pre_RT_experimental, aes(log_RT)) + geom_histogram(binwidth = .1) + facet_wrap(~subject) + scale_y_continuous(limits = c(0,30)) + scale_x_continuous(limits = c(-8,-5))
print(RT_hist_experimental)
```

**Conclusion**: Using untransformed data because they look more normal (at least overall)

### Model RT
```{r}
SPWM_RT_model <- lmer(RT ~ group*stimtype + (1|subject), data = SPWM_data_pre_RT)
summary(SPWM_RT_model)
```

**Conclusion**: the experimental group is trending a slightly slower RT than the Control group overall. Otherwise no modeled differences found.

### Model log_RT
Note: maybe the raw RTs do violate assumptions of normality
```{r}
SPWM_log_RT_model <- lmer(log_RT ~ group*stimtype + (1|subject), data = SPWM_data_pre_RT)
summary(SPWM_log_RT_model)
```

**Conclusion**: The trending difference disappeared (now we have to decide which analysis is more valid), thought: get a quantitative measure for skew and normality and see if log or raw RT is better.

## Conclusions:
Good:
No statistically significant differences between groups in either ACC or RT

Bad:
There is a trend where experimental RT is slower than Control RT
^This disappears with log_RT
a couple of subjects have abnormally low accuracy in the non-matching condition.

